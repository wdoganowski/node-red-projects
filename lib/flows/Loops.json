[{"id":"1c4074bd.e3bf8b","type":"function","name":"loop","func":"context.loop = context.loop || \"stop\";\ncontext.loops = context.loops || 0;\n\nconsole.log(\"topic :\" + msg.topic);\nconsole.log(\"loop  :\" + context.loop);\nconsole.log(\"loops :\" + context.loops);\nconsole.log(\"action:\" + msg.payload);\n\nif (msg.payload == \"stop\") {\n\tcontext.loops = context.loops + 1;\n\tmsg.payload = \"\";\n\tcontext.global.loop = \"stop\";\n\treturn [null,null];\n} else if (msg.payload == \"toggle\") {\n\tmsg.payload = \"\";\n\tif (context.loop == \"start\") {\n\t\tcontext.loop = \"stop\";\n\t\treturn [null,null];\n\t} else {\n\t\tcontext.loop = \"start\";\n\t\tcontext.loops = 1;\n\t\treturn [msg,msg];\n\t}\n} else if (context.loop == \"start\") {\n\t\tcontext.loops = context.loops + 1;\n\t\treturn [msg,msg];\n\t} else {\n\t\treturn [null,null]; \n\t}\n","outputs":"2","x":497,"y":418,"z":"1fe2ab2d.e01d55","wires":[["7b60d417.849f2c"],["a380b8b5.5c7f48"]]}]